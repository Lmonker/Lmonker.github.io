<!DOCTYPE html>
<html lang="en">
    <head>
    <title>音乐播放器案例</title>
        <meta charset="utf-8">
        <style type="text/css" media="screen">
            *{margin:0;padding:0;}
            #box{width:300px;height:600px;margin:10px auto;position:relative;background:rgba(255,255,255,.2);cursor:default;overflow:hidden;}
            #box div{position:absolute;width:300px;}
            #box #top{height:15%;top:3%;}
            #box #middle{height:60%;top:18%;}
            #box #bottom{height:22%;top:78%;}
            #bottom ul li{background:url('img/icon.png') no-repeat;width:40px;height:40px;float: left;list-style: none;margin-left: 16px;}
            .rotate1{animation:rotate 10s linear infinite;}
            @keyframes rotate{
                0%{transform: rotate(0deg);}
                25%{transform: rotate(90deg);}
                50%{transform: rotate(180deg);}
                75%{transform: rotate(270deg);}
                100%{transform:rotate(360deg);}
            }
            .heart{animation:heart 1s linear;}
            @keyframes heart{
                0%{transform: scale(1);}
                50%{transform: scale(1.4);}
                100%{transform:scale(1);}
            }
            #list #listul li{width:97%;height:40px;list-style: none;color:#fff;line-height: 40px;font-size: 14px;padding-left: 3%;cursor:pointer;}
            #list #listul li:hover{background:rgba(0,0,0,.5);}
        </style>
        <script src="lyric.js"></script>
    </head>
    <body onselectstart='return false' style="background:#000">
    <div id="box">
        <audio src="music/Beyond-海阔天空.mp3" id="adi">
            <source src="/media/audio.oga">
            <source src="/media/audio.wav">
        </audio>
        <div id='top'><span style="color:#fff;font-size: 18px;margin-left: 10px;" id="spa">海阔天空</span><p id="p" style="color:#fff;font-size: 12px;margin-left: 10px;margin-top: 3px;">Beyond></p><div id="moon" style="width:40px;height:40px;top:0px;right:0px;background:url('img/icon.png') no-repeat;background-position: -324px 0px;cursor:pointer;" title='夜间模式'></div>

        <img class='op' id="img1" src="img/1_WPS.png" alt="" width="20px" height="20px" style="left:30px;top:60px;position:absolute;z-index:100;opacity:0;">
        <div id="volume" class='op' style="width:200px;height:2px;background:#fff;left:60px;top:70px;position:absolute;opacity:0;"><div class='op' id="div7" style='width:8px;height:8px;border-radius: 50px;background:#fff;top:-4px;left:200px;z-index:100;opacity:0;'>
        </div></div>
        </div>
        <div id="middle">
        <div id="rotate" class style="width:200px;height:200px;border-radius: 50%;overflow: hidden;top:90px;left:48px;background:url('img/music2.png') no-repeat;border-radius: 50%;border:4px solid rgba(255,255,255,.1);"><div style="width:140px;height:140px;border-radius: 50%;overflow: hidden;top:30px;left:30px;">
            <img  id='fm' src="img/1.jpg" alt="" width="140px" height="140px">
        </div></div>
        <div id="text" style="width:100%;height:100%;text-align: center;color:rgba(120,120,120);overflow:hidden;line-height: 30px;display:none;position:relative;">
        
        <div id='text1' style="top:150px">
            </div>
        </div>

        </div>
        <div id="bottom">
            <ul style='height:40px;width:100%;opacity:0;' id="ul1">
                <li style="background-position: 16px -40px;" id="heart"></li>
                <li style="background-position: -27px -38px"></li>
                <li style="background-position: -164px -41px"></li>
                <li style="background-position: -118px -40px"></li>
                <li style="background-position: -80px -40px"></li>
            </ul>
            <div id="div4" style="width:40px;height:15px;color:#fff;font-size: 10px;margin:10px 5px;">00:00:00</div>
            <div id="div25" style="width:200px;height:8px;margin:14px 50px;position:relative;">
            <div id='div2' style="width:200px;height:1px;background:rgba(78,81,65);margin:2px 0px;position:absolute;">
                <div id="div6" style="width:0px;height:100%;background:#fff;">
                    
                </div>
                <div id="div3" style="width:8px;height:8px;box-shadow:0px 0px 5px #fff;border-radius: 50px;background:#fff;top:-4px;left:0px;display:inline-block;">
                    
                </div>
                </div>
            </div>
            <div id="div5" style="width:40px;height:15px;color:#fff;font-size:10px;margin:-27px 255px;">00:00:00</div>
            <ul style='height:40px;width:100%;margin-top: 0px;' id="ul2">
                <li style="background-position: -29px -125px" title='单曲循环'></li>
                <li style="background-position: 10px -128px;" title='上一曲'></li>
                <li style="background-position: 13px 8px;border:1px solid #fff;border-radius: 50%";></li>      <!-- 142 -->
                <li style="background-position: 6px -91px" title='下一曲'></li>
                <li style="background-position: -35px -89px" title='歌单'></li>
            </ul>

        </div>
        <div id="list" style="width:300px;height:300px;position:absolute;bottom:-300px;background:rgb(40,48,71);border-top-left-radius: 20px;border-top-right-radius: 20px;">
            
                <div style="width:97%;height:40px;color:#fff;line-height: 40px;padding-left: 3%;border-top-left-radius: 20px;border-top-right-radius: 20px;font-size: 12px;">所在歌单：我的收藏
                <p style='position:absolute;right:10px;top:0px;'>歌曲数：4</p>
                <div style='position:absolute;top=0px;left:125px;background:rgba(255,255,255,.5);width:50px;height:10px;display:inline-block;border-top:1px solid rgb(40,48,71);border-bottom-right-radius:5px;border-bottom-left-radius:5px;z-index: 100;cursor:pointer;' title="点击关闭" id="close"></div></div><br><br>
                <ul id="listul">
                <li>Beyond-海阔天空</li>
                <li>杨宗纬-一次就好</li>
                <li>毛不易-消愁</li>
                <li>林俊杰-小瓶子</li>
            </ul>
        </div>
    </div>
    <script>
        var ul1=document.getElementById('ul1');
        var ul2=document.getElementById('ul2');
        var list=document.getElementById('list');
        var close=document.getElementById('close');
        var oLi=document.getElementById('ul2').getElementsByTagName('li');
        var oLi1=document.getElementById('ul1').getElementsByTagName('li');
        var oLi2=document.getElementById('listul').getElementsByTagName('li');
        var p=document.getElementById('p');
        var span=document.getElementById('spa');
        var fm=document.getElementById('fm');
        var box=document.getElementById('box');
        var moon=document.getElementById('moon');
        var oAdi=document.getElementById('adi');
        var rotate=document.getElementById('rotate');
        var div5=document.getElementById('div5');
        var div4=document.getElementById('div4');
        var div3=document.getElementById('div3');
        var div2=document.getElementById('div2');
        var div6=document.getElementById('div6');
        var div25=document.getElementById('div25');
        var text1=document.getElementById('text1');
        var text=document.getElementById('text');
        var img1=document.getElementById('img1');
        var volume=document.getElementById('volume');
        var op = document.getElementsByClassName('op');
        var play=true;
        var moon1=true;
        var sportTime=0;
        var allTime=0;
        var curr1=0;
        var t1=0;
        var t2=0;
        var r1=0;
        var l=0;
        // var rT=0;
        oLi[2].onclick=startStop;
        set();
        oLi[0].onclick=function(){
            switch(r1){
                case 0:
                this.style.backgroundPosition='-74px -125px';
                oAdi.loop=true;
                r1=1;
                break;
                case 1:
                this.style.backgroundPosition='-29px -125px';
                oAdi.loop=false;
                // setInterval(function(){
                //     if(sportTime>=allTime){clearInterval(oLi[2].timer3);nt();sportTime=0;}
                // },1000);
                r1=0;
                // this.tim=setInterval(function(){
                //     if(oAdi.currentTime>=allTime){
                //         l++;
                //         ly(l);
                //         clearInterval(this.tim);
                //     }
                // },1000);
                break;
            }
        }
        //上一个 下一个
        var lw=2;
        oLi[3].onclick=nt;
        function nt(){
            //console.log(1);
            if(lw==0){lw=8};
            ly(l);
            if(!play){oAdi.play();}
            text1.style.top=150+'px';
        };
        oLi[1].onclick=function(){
            if(lw==0){lw=10};
            ly(lw);
            if(!play){oAdi.play();}
            text1.style.top=150+'px';
        }
        function ly(u){
            switch(u){
                case 8:
                oAdi.src='music/杨宗纬-一次就好.mp3';
                set();
                span.innerHTML='一次就好';
                p.innerHTML='杨宗纬>';
                fm.src='img/rotate1.jpg';
                lyric.ycjh();
                fg();
                break;
                case 9:
                lyric.xChou();
                fg();
                oAdi.src='music/毛不易-消愁.mp3';
                set();
                span.innerHTML='消愁';
                p.innerHTML='毛不易>';
                fm.src='img/rotate2.jpg';
                
                break;
                case 10:
                oAdi.src='music/林俊杰-小瓶子.mp3';
                set();
                span.innerHTML='小瓶子';
                p.innerHTML='林俊杰>';
                fm.src='img/rotate3.jpg';
                lyric.xpz();
                fg();
                break;
                default:
                oAdi.src='music/Beyond-海阔天空.mp3';
                set();
                span.innerHTML='海阔天空';
                p.innerHTML='Beyond>';
                fm.src='img/1.jpg';
                lyric.beyond();
                fg();
        }
        }
        lyric.beyond();



        moon.onclick=function(){
            if(moon1){
            box.style.background='rgba(32,31,37)';
            moon1=false;
        }else{box.style.background='rgba(255,255,255,.2)';moon1=true;}
    }
        oLi1[0].onclick=function(){
            this.className='heart';
        }
        //旋转定位
        /*function c(){
            X=rT%5*72;
            $('#rotate').css({
                transform:'rotate('+X+'deg)'

            })
            // rotate.style.rotate=rT+'deg';
        }*/
        rotate.onclick=function(){
            this.style.display='none';
            text.style.display='block';
            ul1.style.opacity='1';
            for(var i=0;i<op.length;i++){
                op[i].style.opacity='1';
            }
        }
        text1.onclick=function(){
            text.style.display='none';
            rotate.style.display='block';
            ul1.style.opacity='0';
            for(var i=0;i<op.length;i++){
                op[i].style.opacity='0';
            }
        }
        //开始与暂停
        function startStop(){
            if(play){
                // console.log(rT);
                // c();
                oAdi.play();
                play=false;
                oLi[2].style.backgroundPosition='-113px 9px';
                rotate.className='rotate1';
                this.timer=setInterval(a,1000);
                this.timer1=setInterval(b,1000);
                this.timer2=setInterval(xyz,1000);
                this.timer3=setInterval(over,1000);
            }else{
                // rT=oAdi.currentTime;
                // console.log(rT);
                // c();
                oAdi.pause();
                play=true;
                oLi[2].style.backgroundPosition='13px 8px';
                rotate.className='';
                clearInterval(this.timer);
                clearInterval(this.timer1);
                clearInterval(this.timer2);
                clearInterval(this.timer3);
                for(var i=0;i<4;i++){
                        oLi2[i].style.background='';
                        clearInterval(oLi2[i].timer);
                        clearInterval(oLi2[i].timer1);
                        clearInterval(oLi2[i].timer2);
                        clearInterval(oLi2[i].timer3);
                
                }
            }
        }
        function over(){
            if(sportTime>=allTime){
                text1.style.top=150+'px';
                div4.innerHTML='00:00:00';
                clearInterval(oLi[2].timer2);
                clearInterval(oLi[2].timer3);
                rotate.className='';
            }
        }
        //总时间
        function set(){
            setTimeout(function(){
                allTime=oAdi.duration;
                if(allTime){
                var h=num(Math.floor(allTime/3600));
                var m=num(Math.floor(allTime/60));
                var s=num(Math.floor(allTime%60));
                div5.innerHTML=h+':'+m+':'+s;
            }
        },1000)
    }
        function num(num){
            if(num<10){
                return '0'+num;
            }else{
                return num;
            }
        }
        //播放时间
        function a(){
            sportTime=oAdi.currentTime;
            var h=num(Math.floor(sportTime/3600));
            var m=num(Math.floor(sportTime/60));
            var s=num(Math.floor(sportTime%60));
            div4.innerHTML=h+':'+m+':'+s;

        }
        //进度条
        function b(){
            var bili=sportTime/allTime;
            var w=195*bili;
            div6.style.width=w+'px';
            div3.style.left=w+'px';
            if(sportTime>=allTime){
                    clearInterval(oLi[2].timer);
                    clearInterval(oLi[2].timer1);
                    div6.style.width=0;
                    div3.style.left=0;
                    oLi[2].style.backgroundPosition='13px 8px';
                    play=true;
                }
        }

        //点击喇叭
        var k=true;
            if(oAdi.volume=1){
                var v=1;
                var vL=div7.style.left;
            }else{
            var v=0;
            var vL=0;
        }
            img1.onclick=function(){
                if(k){
                    oAdi.volume=0;
                    this.src='img/3.png';
                    div7.style.left=0;
                    k=false;
                }else{
                    oAdi.volume=v;
                    this.src='img/1_WPS.png';
                    div7.style.left=vL;
                    k=true;
                }
        //     if(oAdi.volu
        //     me>0){
        //         oAdi.volume=0;
        //     }else{
        //     oAdi.volume=1;
        // }
        }
        //音量
        div7.onmousedown=d;
        function d(ev){
            var ev=ev||window.event;
            var x = ev.clientX - div7.offsetLeft;
            // this.style.width=10+'px';
            // this.style.height=10+'px';
            document.onmousemove=function(ev){
                var ev=ev||window.event;
                var _left = ev.clientX - x;
                if(_left<0){
                    _left=0;
                    img1.src='img/3.png';
                }else if(_left>200){
                    _left=200;
                }else{
                    img1.src='img/1_WPS.png';
                    _left=_left;
                }
                div7.style.left = _left+'px';
                oAdi.volume=_left/200*1;
                v=oAdi.volume;
                vL=div7.style.left;
            }
        }
        document.onmouseup=function(){
            // clearInterval(div3.timer)
            this.onmousemove=null;
            // div4.style.width=8+'px';
            // div4.style.height=8+'px';
            // div3.style.width=5+'px';
            // div3.style.height=5+'px';
        }

        var ms=0;
        var t=[];
        fg();
        function fg(){
        var textT=text1.innerHTML;
        text1.innerHTML='';
        t=[];                                            //清空t 以免被上一次保存
        var arr=textT.split('[');
        for(var i=0;i<arr.length;i++){
            var ms=i;
            var arr1=arr[i].split(']');
            var timer = arr1[0].split(".");
            var timers=timer[0].split(':');
            ms=timers[1]*1+timers[0]*60;                //必须乘以1 转化为number 否则为数组的拼接
            t[i]=ms;
            if(arr1[1]){
                text1.innerHTML+="<p id=s"+ms+">"+arr1[1]+"</p>";
        }
    }
}
    setTimeout(function(){
            document.getElementById('s0').style.color='#fff';
        },300);
    /*oAdi.addEventListener('timeupdate',function(){
        var curr=parseInt(oAdi.currentTime);
        if(document.getElementById("s"+curr)){
            if(document.getElementById("s"+curr1)){
            document.getElementById("s"+curr1).style.color='#ccc';
        }
            document.getElementById("s"+curr).style.color='#fff';
            curr1=curr;
            }
    })*/

    //歌词滚动
    var t3=0;
    function xyz(){
        //console.log(1);
        var curr=parseInt(oAdi.currentTime);
        for(var i=0;i<t.length;i++){
        if(curr==t[i]&&curr!=0){
            if(document.getElementById("s"+curr1)){
            document.getElementById("s"+curr1).style.color='rgba(120,120,120)';
        }
            document.getElementById("s"+curr).style.color='#fff';
            curr1=curr;
            
            if(!move){t1=t2;t3=i;t1=150-t3*30;t3++;}else{t1=150-t3*30;t3++;}
            text1.style.top=t1+'px';
            }}
        }

    volume.onclick=function(ev){
        var ev=ev||window.event;
        oAdi.volume=ev.offsetX/200*1;
        div7.style.left = ev.offsetX+'px';
    }
        //点击进度条调节进度以及歌词跳转
    var move=true;
    div25.onclick=function(ev){
        for(var i=0;i<t.length;i++){
            if(i==t.length-1){
                var qq=t[i];
                //console.log(qq);
            }
        }
        var len=180-t.length*30;
        var ev=ev||window.event;
        move=false;
        var w=ev.offsetX;
        div6.style.width=w+'px';
        div3.style.left=w+'px';
        var tm=ev.offsetX/200*allTime;
        var h=num(Math.floor(tm/3600));
        var m=num(Math.floor(tm/60));
        var s=num(Math.floor(tm%60));
        div4.innerHTML=h+':'+m+':'+s;
        oAdi.currentTime=tm;
        var curr=parseInt(oAdi.currentTime);
        for(var i=0;i<t.length;i++){
        if(curr>=t[i]&&curr<=t[i+1]){
            document.getElementById("s"+qq).style.color='rgba(120,120,120)';
            curr-t[i]>t[i+1]-curr?curr=t[i+1]:curr=t[i];
            if(document.getElementById("s"+curr1)){
            document.getElementById("s"+curr1).style.color='rgba(120,120,120)';
        }
            document.getElementById("s"+curr).style.color='#fff';
            curr1=curr;            
            curr-t[i]>t[i+1]-curr?t2=150-(i+1)*30:t2=150-i*30;
            text1.style.top=t2+'px';
            }else if(curr>qq){text1.style.top=len+'px';document.getElementById("s"+qq).style.color='#fff';}
        }
    }


    //歌单
    var bo=0;
    oLi[4].onclick=function(){
        bo=-300;
        timer=setInterval(function(){
            bo +=15;
            if(bo>0){
                bo=0;
                clearInterval(this.timer);
            }
            list.style.bottom = bo+'px';
        },13)
    }
    close.onclick=function(){
        bo=0;
        timer=setInterval(function(){
            bo -=15;
            if(bo<-300){
                bo=-300;
                clearInterval(this.timer);
            }
            list.style.bottom = bo+'px';
        },13)
    }


    //列表点击播放
    var index=0;
    //var click=0;
    for(var i=0;i<oLi2.length;i++){
        oLi2[i].index=i;
        oLi2[i].onclick=function(){
            this.style.background='rgba(0,0,0,.5)';
            index=this.index+7;
            ly(index);
            oAdi.play();
                play=false;
                text1.style.top=150+'px';
                t3=0;                                               //t3清零
                oLi[2].style.backgroundPosition='-113px 9px';
                rotate.className='rotate1';
                this.timer=setInterval(a,1000);
                this.timer1=setInterval(b,1000);
                this.timer2=setInterval(xyz,1000);
                this.timer3=setInterval(over,1000);
                //switch(index){
                    //case 8:
                for(var i=0;i<4;i++){
                    if(i!=index-7){
                        oLi2[i].style.background='';
                        clearInterval(oLi2[i].timer);
                        clearInterval(oLi2[i].timer1);
                        clearInterval(oLi2[i].timer2);
                        clearInterval(oLi2[i].timer3);
                    }
                }
                clearInterval(oLi[2].timer);
                clearInterval(oLi[2].timer1);
                clearInterval(oLi[2].timer2);
                clearInterval(oLi[2].timer3);
                    //break;


                //}
            /*if(index==click){
                //clearInterval(oLi[2].timer);
                //clearInterval(oLi[2].timer1);
                clearInterval(oLi[click].timer2);
                //clearInterval(oLi[2].timer3);
            }
            oAdi.play();
                play=false;
                oLi[2].style.backgroundPosition='-113px 9px';
                rotate.className='rotate1';
                this.timer=setInterval(a,1000);
                this.timer1=setInterval(b,1000);
                this.timer2=setInterval(xyz,1000);
                this.timer3=setInterval(over,1000);
                clearInterval(oLi[2].timer);
                clearInterval(oLi[2].timer1);
                clearInterval(oLi[2].timer2);
                clearInterval(oLi[2].timer3);*/
                
                //click=index-7;
            
        }
    }

    //还有列表循环播放功能未完成
    </script>
    </body>
</html>
